import{_ as T,d as j,r as h,a as s,o as y,c as w,w as t,b as e,e as n,t as i,f as u,g as I,h as M,i as K,j as U}from"./entry-2b941c5d.mjs";import{u as C}from"./fetch-e279150a.mjs";import{u as N}from"./cookie-72a35f76.mjs";const H=j({__name:"PageHeader",props:["currentUser"],setup(F,{expose:o}){o();const c=F,a=h("1"),R={props:c,activeIndex:a,handleSelect:async(_,v)=>{if(_=="logout"){const{data:r}=await C("http://kavli.pku.edu.cn:8888/logout",{method:"post",body:c.currentUser});if(console.log(r.value),r.value.result==!0){const k=N("userInfo");k.value=void 0,window.location.href="/login"}}}};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),W=n("KIAA - Domestic Travel Application"),Y=u("div",{class:"flex-grow"},null,-1),G=n("Logout");function J(F,o,c,a,m,R){const _=s("el-menu-item"),v=s("el-sub-menu"),r=s("el-menu");return y(),w(r,{"default-active":a.activeIndex,class:"el-menu-demo",mode:"horizontal",ellipsis:!1,onSelect:a.handleSelect},{default:t(()=>[e(_,{index:"0"},{default:t(()=>[W]),_:1}),Y,e(v,{index:"1"},{title:t(()=>[n(i(a.props.currentUser.name)+" - "+i(a.props.currentUser.pkuId),1)]),default:t(()=>[e(_,{index:"logout"},{default:t(()=>[G]),_:1})]),_:1})]),_:1},8,["default-active"])}var Q=T(H,[["render",J]]);const X=j({__name:"DataTable",props:["currentUser"],async setup(F,{expose:o}){o();let c,a;const m=F,R=h("large"),_=h(),v=h(!1),r=I({name:m.currentUser.name,pkuId:m.currentUser.pkuId,approvedBy:"",approvalStatus:"not-submitted",reason:"",mobile:"",destinationIsLowRiskArea:"",dateOfLeavingBeijing:null,transportationLeaving:"",transportationDetailsLeaving:"",stopoverPlacesLeaving:"",destination:"",dateOfReturningToBeijing:null,transportationReturning:"",transportationDetailsReturning:"",stopoverPlacesReturning:"",dateOfReturningToPKU:null,submissionDate:null,applicationId:null}),k=I({reason:[{type:"string",required:!0,message:"Please input Reason",trigger:"blur"}],mobile:[{type:"string",required:!0,message:"Please input Mobile",trigger:"blur"}],destinationIsLowRiskArea:[{type:"string",required:!0,message:"Please Select Risk Level",trigger:"blur"}],dateOfLeavingBeijing:[{type:"date",required:!0,message:"Please pick date of leaving Beijing",trigger:"blur"}],transportationLeaving:[{type:"string",required:!0,message:"Please input transportation",trigger:"blur"}],transportationDetailsLeaving:[{type:"string",required:!0,message:"Please input transportation details",trigger:"blur"}],stopoverPlacesLeaving:[{type:"string",required:!0,message:"Please input stopover places",trigger:"blur"}],destination:[{type:"string",required:!0,message:"Please input Destination",trigger:"blur"}],dateOfReturningToBeijing:[{type:"date",required:!0,message:"Please pick date of returning to Beijing",trigger:"blur"}],transportationReturning:[{type:"string",required:!0,message:"Please input transportation",trigger:"blur"}],transportationDetailsReturning:[{type:"string",required:!0,message:"Please input transportation details",trigger:"blur"}],stopoverPlacesReturning:[{type:"string",required:!0,message:"Please input stopover places",trigger:"blur"}],dateOfReturningToPKU:[{type:"date",required:!0,message:"Please pick date of returning to PKU",trigger:"blur"}]});let A="";m.currentUser.role=="admin"?A="http://kavli.pku.edu.cn:8888/applications":A="http://kavli.pku.edu.cn:8888/applications?pkuId="+m.currentUser.pkuId;const{data:B,pending:p,refresh:O,error:x}=([c,a]=M(()=>C(A)),c=await c,a(),c);let L=I(B.value.applications),b=h(!1);const d=h({}),P={props:m,formSize:R,ApplicationFormRef:_,dialogDetails:v,ApplicationFormData:r,ApplicationFormRules:k,url:A,resp:B,pending:p,refresh:O,error:x,tableData:L,drawerOpen:b,applicationDetails:d,onDetails:(g,D)=>{console.log(D),d.value=D,v.value=!0},onApprove:async(g,D)=>{console.log(g),console.log(D.applicationId);const{data:V}=await C("http://kavli.pku.edu.cn:8888/applications/"+D.applicationId,{method:"put",body:{approvedBy:m.currentUser.name,approvalStatus:"approved"}});console.log(V.value),D.approvedBy=m.currentUser.name,D.approvalStatus="approved"},onSubmit:async g=>{console.log(r);const D=new Date;let V=!1;if(console.log(g),r.approvalStatus="pending-approval",r.submissionDate=D.toLocaleDateString(),await g.validate((S,l)=>{S?(console.log("valid!"),V=!0):console.log("not valid!",l)}),V){r.dateOfLeavingBeijing=r.dateOfLeavingBeijing.toLocaleDateString(),r.dateOfReturningToBeijing=r.dateOfReturningToBeijing.toLocaleDateString(),r.dateOfReturningToPKU=r.dateOfReturningToPKU.toLocaleDateString();const{data:S}=await C("http://kavli.pku.edu.cn:8888/applications",{method:"post",body:r});console.log(S.value),b.value=!1,location.reload()}}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),Z=n("New Request"),$={style:{display:"flex","align-items":"center"}},ee={style:{"margin-left":"10px"}},te={style:{"margin-left":"10px"}},ae={style:{display:"flex","align-items":"center"}},le={style:{display:"flex","align-items":"center"}},oe={style:{display:"flex","align-items":"center"}},ne=n("Pending Approval"),ie=n("Not Submitted"),re=n("Approved"),se={style:{display:"flex","align-items":"center"}},ue=n("Details"),de=n("Approve"),pe={class:"dialog-footer"},ce=n("Cancel"),_e=n("Confirm"),me=n(" \u4E2A\u4EBA\u4FE1\u606F "),ge=n("Whether the destination is a low-risk area ?"),fe=n(" \u79BB\u4EAC\u4FE1\u606F "),ve=n(" \u8FD4\u4EAC\u4FE1\u606F "),De={style:{flex:"auto"}},be=n("Cancel"),Ae=n("Save");function ye(F,o,c,a,m,R){const _=s("el-button"),v=s("el-row"),r=s("el-table-column"),k=s("el-popover"),A=s("el-tag"),B=s("el-table"),p=s("el-descriptions-item"),O=s("el-descriptions"),x=s("el-dialog"),L=s("el-divider"),b=s("el-input"),d=s("el-form-item"),f=s("el-col"),E=s("el-radio"),q=s("el-radio-group"),P=s("el-date-picker"),g=s("el-option"),D=s("el-select"),V=s("el-form"),S=s("el-drawer");return y(),K("div",null,[e(v,{justify:"end"},{default:t(()=>[e(_,{type:"primary",onClick:o[0]||(o[0]=l=>a.drawerOpen=!0)},{default:t(()=>[Z]),_:1})]),_:1}),e(B,{data:a.tableData,style:{width:"100%"}},{default:t(()=>[e(r,{label:"Submission Date"},{default:t(l=>[u("div",$,[u("span",null,i(l.row.submissionDate),1)])]),_:1}),c.currentUser.role=="admin"?(y(),w(r,{key:0,label:"RequestedBy"},{default:t(l=>[e(k,{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:t(()=>[u("div",null,"Name: "+i(l.row.name),1),u("div",null,"PKU ID: "+i(l.row.pkuId),1),u("div",null,"Mobile: "+i(l.row.mobile),1)]),reference:t(()=>[u("span",ee,i(l.row.name),1)]),_:2},1024)]),_:1})):U("",!0),e(r,{label:"Destination"},{default:t(l=>[e(k,{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:t(()=>[u("div",null," Destination Is Low Risk Area: "+i(l.row.destinationIsLowRiskArea),1),u("div",null,"Transportation: "+i(l.row.transportationLeaving),1),u("div",null," Transportation Details: "+i(l.row.transportationDetailsLeaving),1),u("div",null,"Stopover Places: "+i(l.row.stopoverPlacesLeaving),1)]),reference:t(()=>[u("span",te,i(l.row.destination),1)]),_:2},1024)]),_:1}),e(r,{label:"Date of Leaving"},{default:t(l=>[u("div",ae,[u("span",null,i(l.row.dateOfLeavingBeijing),1)])]),_:1}),e(r,{label:"Date of Returning"},{default:t(l=>[u("div",le,[u("span",null,i(l.row.dateOfReturningToBeijing),1)])]),_:1}),e(r,{label:"Status"},{default:t(l=>[u("div",oe,[l.row.approvalStatus=="pending-approval"?(y(),w(A,{key:0,class:"ml-2",type:"warning"},{default:t(()=>[ne]),_:1})):l.row.approvalStatus=="not-submitted"?(y(),w(A,{key:1,class:"ml-2",type:"info"},{default:t(()=>[ie]),_:1})):U("",!0),l.row.approvalStatus=="approved"?(y(),w(A,{key:2,class:"ml-2",type:"success"},{default:t(()=>[re]),_:1})):U("",!0)])]),_:1}),c.currentUser.role=="user"?(y(),w(r,{key:1,label:"Approved By"},{default:t(l=>[u("div",se,[u("span",null,i(l.row.approvedBy),1)])]),_:1})):U("",!0),c.currentUser.role=="admin"?(y(),w(r,{key:2,label:"Actions"},{default:t(l=>[e(_,{size:"small",onClick:z=>a.onDetails(l.$index,l.row)},{default:t(()=>[ue]),_:2},1032,["onClick"]),l.row.approvalStatus=="pending-approval"?(y(),w(_,{key:0,size:"small",type:"primary",onClick:z=>a.onApprove(l.$index,l.row)},{default:t(()=>[de]),_:2},1032,["onClick"])):U("",!0)]),_:1})):U("",!0)]),_:1},8,["data"]),e(x,{modelValue:a.dialogDetails,"onUpdate:modelValue":o[3]||(o[3]=l=>a.dialogDetails=l),title:"Details",width:"50%"},{footer:t(()=>[u("span",pe,[e(_,{onClick:o[1]||(o[1]=l=>F.dialogVisible=!1)},{default:t(()=>[ce]),_:1}),e(_,{type:"primary",onClick:o[2]||(o[2]=l=>F.dialogVisible=!1)},{default:t(()=>[_e]),_:1})])]),default:t(()=>[e(O,{title:"Application Details",direction:"vertical",border:""},{default:t(()=>[e(p,{label:"Name"},{default:t(()=>[n(i(a.applicationDetails.name),1)]),_:1}),e(p,{label:"PKU ID"},{default:t(()=>[n(i(a.applicationDetails.pkuId),1)]),_:1}),e(p,{label:"Mobile"},{default:t(()=>[n(i(a.applicationDetails.mobile),1)]),_:1}),e(p,{label:"Date of Leaving Beijing"},{default:t(()=>[n(i(a.applicationDetails.dateOfLeavingBeijing),1)]),_:1}),e(p,{label:"Destination"},{default:t(()=>[n(i(a.applicationDetails.destination),1)]),_:1}),e(p,{label:"Destination Is Low Risk Area"},{default:t(()=>[n(i(a.applicationDetails.destinationIsLowRiskArea),1)]),_:1}),e(p,{label:"Reason"},{default:t(()=>[n(i(a.applicationDetails.reason),1)]),_:1}),e(p,{label:"Date of Returning to Beijing"},{default:t(()=>[n(i(a.applicationDetails.dateOfReturningToBeijing),1)]),_:1}),e(p,{label:"Date of Returning to PKU"},{default:t(()=>[n(i(a.applicationDetails.dateOfReturningToPKU),1)]),_:1}),e(p,{label:"Transportation Leaving Beijing"},{default:t(()=>[n(i(a.applicationDetails.transportationLeaving),1)]),_:1}),e(p,{label:"Transportation Details"},{default:t(()=>[n(i(a.applicationDetails.destinationIsLowRiskArea),1)]),_:1}),e(p,{label:"Stopover Places"},{default:t(()=>[n(i(a.applicationDetails.stopoverPlacesLeaving),1)]),_:1}),e(p,{label:"Transportation Returning to Beijing"},{default:t(()=>[n(i(a.applicationDetails.transportationReturning),1)]),_:1}),e(p,{label:"Transportation Details"},{default:t(()=>[n(i(a.applicationDetails.transportationDetailsReturning),1)]),_:1}),e(p,{label:"Stopover Places"},{default:t(()=>[n(i(a.applicationDetails.stopoverPlacesReturning),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(S,{modelValue:a.drawerOpen,"onUpdate:modelValue":o[20]||(o[20]=l=>a.drawerOpen=l),title:"Domestic Travel Application of KIAA",direction:"rtl",size:"60%"},{default:t(()=>[e(V,{ref:"ApplicationFormRef",model:a.ApplicationFormData,rules:a.ApplicationFormRules,"label-width":"180px","label-position":"right",size:a.formSize,"status-icon":""},{default:t(()=>[e(L,{"content-position":"left"},{default:t(()=>[me]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"\u5DE5\u53F7(PKU ID)",prop:"pkuId"},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.pkuId,"onUpdate:modelValue":o[4]||(o[4]=l=>a.ApplicationFormData.pkuId=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u624B\u673A\u53F7(Mobile)",prop:"mobile",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.mobile,"onUpdate:modelValue":o[5]||(o[5]=l=>a.ApplicationFormData.mobile=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{label:"\u79BB\u4EAC\u4E8B\u7531",prop:"reason",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.reason,"onUpdate:modelValue":o[6]||(o[6]=l=>a.ApplicationFormData.reason=l),placeholder:"Reason for leaving Beijing",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u76EE\u7684\u5730\u662F\u5426\u4F4E\u98CE\u9669\u5730\u533A",prop:"destinationIsLowRiskArea",required:""},{default:t(()=>[e(f,{span:12},{default:t(()=>[ge]),_:1}),e(f,{span:12},{default:t(()=>[e(q,{modelValue:a.ApplicationFormData.destinationIsLowRiskArea,"onUpdate:modelValue":o[7]||(o[7]=l=>a.ApplicationFormData.destinationIsLowRiskArea=l)},{default:t(()=>[e(E,{label:"\u662F(Yes)"}),e(E,{label:"\u5426(No)"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(L,{"content-position":"left"},{default:t(()=>[fe]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"\u79BB\u4EAC\u65E5\u671F",required:""},{default:t(()=>[e(d,{prop:"dateOfLeavingBeijing"},{default:t(()=>[e(P,{modelValue:a.ApplicationFormData.dateOfLeavingBeijing,"onUpdate:modelValue":o[8]||(o[8]=l=>a.ApplicationFormData.dateOfLeavingBeijing=l),type:"date",placeholder:"Date of leaving Beijing",size:"large",style:{width:"285px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u4EA4\u901A\u5DE5\u5177",prop:"transportationLeaving",required:""},{default:t(()=>[e(D,{modelValue:a.ApplicationFormData.transportationLeaving,"onUpdate:modelValue":o[9]||(o[9]=l=>a.ApplicationFormData.transportationLeaving=l),placeholder:"Pick your transportation",style:{width:"285px"}},{default:t(()=>[e(g,{label:"\u98DE\u673A(Flight)",value:"flight"}),e(g,{label:"\u706B\u8F66(Train)",value:"train"}),e(g,{label:"\u79C1\u5BB6\u8F66(Private Car)",value:"privateCar"}),e(g,{label:"\u5176\u4ED6(Others)",value:"others"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u822A\u73ED\u53F7/\u8F66\u6B21",prop:"transportationDetailsLeaving",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.transportationDetailsLeaving,"onUpdate:modelValue":o[10]||(o[10]=l=>a.ApplicationFormData.transportationDetailsLeaving=l),placeholder:"Flight/Train Number"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u76EE\u7684\u5730",prop:"destination",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.destination,"onUpdate:modelValue":o[11]||(o[11]=l=>a.ApplicationFormData.destination=l),placeholder:"Destination"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{label:"\u7ECF\u505C\u5730\u70B9",prop:"stopoverPlacesLeaving",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.stopoverPlacesLeaving,"onUpdate:modelValue":o[12]||(o[12]=l=>a.ApplicationFormData.stopoverPlacesLeaving=l),placeholder:"Stopover Places",type:"textarea"},null,8,["modelValue"])]),_:1}),e(L,{"content-position":"left"},{default:t(()=>[ve]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"\u8FD4\u4EAC\u65E5\u671F",required:""},{default:t(()=>[e(d,{prop:"dateOfReturningToBeijing"},{default:t(()=>[e(P,{modelValue:a.ApplicationFormData.dateOfReturningToBeijing,"onUpdate:modelValue":o[13]||(o[13]=l=>a.ApplicationFormData.dateOfReturningToBeijing=l),type:"date",label:"Pick a date",placeholder:"Date of returning to Beijing",style:{width:"285px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u4EA4\u901A\u5DE5\u5177",prop:"transportationReturning",required:""},{default:t(()=>[e(D,{modelValue:a.ApplicationFormData.transportationReturning,"onUpdate:modelValue":o[14]||(o[14]=l=>a.ApplicationFormData.transportationReturning=l),placeholder:"Pick your transportation",style:{width:"285px"}},{default:t(()=>[e(g,{label:"\u98DE\u673A(Flight)",value:"flight"}),e(g,{label:"\u706B\u8F66(Train)",value:"train"}),e(g,{label:"\u79C1\u5BB6\u8F66(Private Car)",value:"privateCar"}),e(g,{label:"\u5176\u4ED6(Others)",value:"others"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u822A\u73ED\u53F7/\u8F66\u6B21",prop:"transportationDetailsReturning",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.transportationDetailsReturning,"onUpdate:modelValue":o[15]||(o[15]=l=>a.ApplicationFormData.transportationDetailsReturning=l),placeholder:"Flight/Train Number"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"\u8FD4\u6821\u65E5\u671F",required:""},{default:t(()=>[e(d,{prop:"dateOfReturningToPKU"},{default:t(()=>[e(P,{modelValue:a.ApplicationFormData.dateOfReturningToPKU,"onUpdate:modelValue":o[16]||(o[16]=l=>a.ApplicationFormData.dateOfReturningToPKU=l),type:"date",label:"Pick a date",placeholder:"Date of returning to PKU",style:{width:"285px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{label:"\u7ECF\u505C\u5730\u70B9",prop:"stopoverPlacesReturning",required:""},{default:t(()=>[e(b,{modelValue:a.ApplicationFormData.stopoverPlacesReturning,"onUpdate:modelValue":o[17]||(o[17]=l=>a.ApplicationFormData.stopoverPlacesReturning=l),placeholder:"Stopover Places ",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","size"])]),footer:t(()=>[u("div",De,[e(_,{onClick:o[18]||(o[18]=l=>a.drawerOpen=!1)},{default:t(()=>[be]),_:1}),e(_,{onClick:o[19]||(o[19]=l=>a.onSubmit(a.ApplicationFormRef)),type:"primary"},{default:t(()=>[Ae]),_:1})])]),_:1},8,["modelValue"])])}var Fe=T(X,[["render",ye]]);const ke=j({__name:"Container",setup(F,{expose:o}){o();const c=N("userInfo"),m={userInfo:c,currentUser:c};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),we={class:"common-layout"},Re=u("p",null,"\u79BB\u4EAC\u7533\u8BF7 (Travel Application)",-1);function Be(F,o,c,a,m,R){const _=Q,v=s("el-header"),r=s("el-divider"),k=Fe,A=s("el-main"),B=s("el-container");return y(),K("div",we,[e(B,null,{default:t(()=>[e(v,null,{default:t(()=>[e(_,{currentUser:a.currentUser},null,8,["currentUser"])]),_:1}),e(B,null,{default:t(()=>[e(A,null,{default:t(()=>[Re,e(r),e(k,{currentUser:a.currentUser},null,8,["currentUser"])]),_:1})]),_:1})]),_:1})])}var he=T(ke,[["render",Be]]);export{he as _};
